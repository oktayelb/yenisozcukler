{% load static %}
<!DOCTYPE html>
<html lang="tr">
<head>
    {% include 'head.html' %}
</head>

<body data-user-auth="{{ request.user.is_authenticated|yesno:'true,false' }}" 
      data-username="{{ request.user.username|default:'' }}">

    <div class="notification-container" id="notificationContainer"></div>
    <div id="modalBackdrop" class="modal-backdrop" onclick="closeCommentView()"></div> 

    <div class="app-layout">
        
        <div class="header-controls">
            <button class="header-btn" id="darkModeToggle">Karanlık Mod</button>
        </div>

        <div class="header-controls-right">
            {% if request.user.is_authenticated %}
                <div class="header-user-info" style="display:flex; align-items:center; gap:10px;">
                    <button class="header-btn" onclick="openProfileModal('{{ request.user.username }}')" style="border: 2px solid var(--accent); color: var(--accent);">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:5px; margin-bottom:-2px;"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                        {{ request.user.username }}
                    </button>
                    <button class="header-btn logout-btn" onclick="handleLogout()" title="Çıkış Yap">
                    <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                    </button>
                </div>
            {% else %}
                <button class="header-btn" onclick="openModal('authModal')">Giriş Yap</button>
            {% endif %}
            <button class="header-btn" onclick="showAboutInfo()">Bu site nedir?</button>
        </div>
        
        <header>
            <div class="logo-wrapper">
                <div class="logo-card theme-red pos-behind" id="cardRed" onclick="animateLogo(this)">
                    <h1 id="mainTitle">Yeni Sözcükler</h1>
                    <span class="subtitle" id="subtitleText">"Yeni küfürlerini de paylaş"</span>
                </div>

                <div class="logo-card theme-default pos-center" id="cardDefault" onclick="animateLogo(this)">
                    <h1 id="mainTitle">Yeni Sözcükler</h1>
                    <span class="subtitle" id="subtitleText">"Yeni sözcüklerini paylaş"</span>
                </div>
            </div>
        </header>

        <div class="container">
            
            <div class="form-card collapsed" id="contributionCard">
                <div class="form-header-toggle" onclick="toggleContributionForm()">
                    <div class="form-title" id="contributionTitle" style="margin:0; font-size: 1.8rem;">
                        Katkıda Bulun <span class="toggle-icon">+</span>
                    </div>
                </div>
                <div class="form-collapsible-wrapper">
                    <form class="form-fields" onsubmit="handleWordSubmit(event)" style="padding-top: 25px;">
                        
                        <div class="form-group">
                            <label>Sözcük</label>
                            <input type="text" id="inputWord" maxlength="50"
                                placeholder=""
                                onkeypress="return allowOnlyLetters(event, true)" 
                                oninput="this.value = this.value.replace(/^\s+/g, '')">
                        </div>

                        <div class="form-group def-wrapper">
                            <label>Tanım</label>
                            <textarea id="inputDef" rows="2" maxlength="300" oninput="updateCount(this)" placeholder="Sözcüğün anlamını açıklayın..." onkeypress="return allowOnlyLetters(event, true)"></textarea>
                            <div class="char-limit" id="charCount">0 / 300</div>
                        </div>

                        <div class="form-group span-full">
                            <label>Örnek Cümle</label>
                            <textarea id="inputExample" rows="2" maxlength="200" 
                                    placeholder="Sözcüğü bir cümle içinde kullanın..." 
                                    onkeypress="return allowOnlyLetters(event, true)"></textarea>
                        </div>

                        <div class="form-group span-full" id="categorySelectionContainer" style="display:none;">
                            <label>Kategoriler <span style="font-weight:normal; font-size:0.85rem; color:var(--text-muted);">(Birden fazla seçilebilir)</span></label>
                            <div class="category-pills-container" id="categoryPillsList"></div>
                            <div id="categoryHelpText" class="category-help-text"></div>
                        </div>

                        <div class="form-submit-wrapper">
                            <div class="submission-hint">
                                Ekleyen: 
                                <span class="author-trigger" id="authorTrigger">
                                    {% if request.user.is_authenticated %}{{ request.user.username }}{% else %}Anonim{% endif %}
                                </span>
                            </div>
                            <button type="submit">Sözlüğe Ekle</button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="activeFilterBanner" class="filter-banner" style="display:none; flex-direction:column; gap:8px;">
                <div style="display:flex; justify-content:space-between; align-items:center; width:100%;">
                    <span><span style="opacity:0.8">Kategori:</span> <strong id="filterNameDisplay"></strong></span>
                    <button onclick="clearCategoryFilter()" style="margin-left:auto;">Filtreyi Temizle ✕</button>
                </div>
                <div id="filterDescDisplay" style="font-size:0.9rem; font-style:italic; border-top:1px solid rgba(255,255,255,0.2); padding-top:4px; display:none;"></div>
            </div>

            <div class="feed-container" id="feedList">
                <div class="spinner"></div>
            </div>

            <div class="load-more-container" id="loadMoreContainer" style="display:none;">
                <button class="load-more-btn" onclick="loadMoreWords()">Daha Fazla Göster</button>
            </div>
        </div>
    </div> <div id="addExampleModal" class="auth-overlay" onclick="closeModal('addExampleModal', false, event)">
        <div class="auth-box" style="max-width: 500px;">
            <button class="close-btn auth-close" onclick="closeModal('addExampleModal', true)">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
            
            <div class="auth-header">
                <h2>Örnek Cümle Ekle</h2>
                <h3 id="exampleModalWord" style="color:var(--accent); margin: 5px 0 10px 0; font-size: 1.4rem;"></h3>
                <p style="color:var(--text-muted); font-size:0.9rem;">
                    Bu işlem sadece bir kez yapılabilir ve sonrasında düzenlenemez.
                </p>
            </div>
            
            <div class="auth-form" style="margin-top:15px;">
                <div class="form-group">
                    <textarea id="newExampleInput" class="custom-textarea" rows="3" maxlength="200" 
                            placeholder="Örnek cümleni buraya yaz..." 
                            style="width:100%; box-sizing:border-box; padding:10px; border-radius:8px; border:1px solid var(--border-light); background:var(--input-bg); color:var(--text-main);"></textarea>
                    <div class="char-count" id="exampleCharCount" style="text-align:right; font-size:0.8rem; color:var(--text-muted); margin-top:5px;">0 / 200</div>
                </div>
                <button id="submitExampleBtn" class="auth-submit-btn" onclick="submitExample()">Kaydet</button>
            </div>
        </div>
    </div>

    {% include 'constant_modals.html' %}

    <div id="profileModal" class="auth-overlay" onclick="closeProfileModal(event)">
        <div class="auth-box" style="max-width: 450px;">
            <button class="close-btn auth-close" onclick="closeProfileModal(event, true)">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>

            <div class="auth-header">
                <div class="profile-header-wrapper">
                    <h2 id="profileUsername" class="profile-username">Yükleniyor...</h2>
                    
                    <button class="edit-profile-btn" onclick="openEditProfileModal()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                        Bilgileri Değiştir
                    </button>
                </div>
                <p style="font-size:0.9rem; color:var(--text-muted); margin-top:5px;">Üyelik Tarihi: <span id="profileDate">-</span></p>
            </div>

            <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; text-align:center;">
                
                <div class="clickable-stat" onclick="openMyWordsModal()" 
                    style="background:var(--input-bg); padding:10px; border-radius:8px; border:1px solid var(--border-light);">
                    <div style="font-weight:bold; font-size:1.2rem; color:var(--accent);" id="statWords">0</div>
                    <div style="font-size:0.75rem; color:var(--text-muted);">Sözcük &rarr;</div>
                </div>

                <div style="background:var(--input-bg); padding:10px; border-radius:8px; border:1px solid var(--border-light);">
                    <div style="font-weight:bold; font-size:1.2rem; color:var(--accent);" id="statComments">0</div>
                    <div style="font-size:0.75rem; color:var(--text-muted);">Yorum</div>
                </div>
                <div style="background:var(--input-bg); padding:10px; border-radius:8px; border:1px solid var(--border-light);">
                    <div style="font-weight:bold; font-size:1.2rem; color:var(--success-color);" id="statScore">0</div>
                    <div style="font-size:0.75rem; color:var(--text-muted);">Puan</div>
                </div>
            </div>
        </div>
    </div>

    <div id="myWordsModal" class="auth-overlay" onclick="closeMyWordsModal(event)">
        <div class="auth-box" style="max-width: 600px; width: 95%; max-height: 85vh; display: flex; flex-direction: column;">
            <button class="close-btn auth-close" onclick="closeMyWordsModal(event, true)">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>

            <div class="auth-header" style="margin-bottom:15px; flex-shrink: 0;">
                <h2>Sözcüklerim</h2>
                <p style="color:var(--text-muted);">Onaylanmış ve yayına alınmış sözcüklerin.</p>
            </div>

            <div id="myWordsFeed" class="custom-scrollbar" style="flex-grow: 1; overflow-y: auto;"></div>
            
            <button onclick="openProfileModal(); document.getElementById('myWordsModal').classList.remove('show');" 
                    style="width:100%; padding:10px; background:none; border:none; color:var(--text-muted); cursor:pointer; margin-top:10px; flex-shrink: 0;">
                &larr; Profile Dön
            </button>
        </div>
    </div>

    <div id="editProfileModal" class="auth-overlay" onclick="closeEditProfileModal(event)">
        <div class="auth-box" style="max-width: 400px;">
            <button class="close-btn auth-close" onclick="closeEditProfileModal(event, true)">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
            <div class="auth-header">
                <h2>Profili Düzenle</h2>
                <p style="color:var(--text-muted);">Kullanıcı bilgilerini buradan güncelleyebilirsin.</p>
            </div>
            
            <h4 style="margin:0 0 10px 0; color:var(--text-main); font-size:1rem;">Kullanıcı Adı</h4>
            <div class="auth-form" style="margin-bottom: 25px;">
                <div class="form-group" style="display:flex; gap:10px;">
                    <input type="text" id="newUsernameInput" placeholder="Kullanıcı Adı" maxlength="20">
                    <button class="auth-submit-btn" onclick="handleChangeUsername()" style="width:auto; margin-top:0; padding:0 20px; white-space:nowrap;">Kaydet</button>
                </div>
            </div>
            <hr style="border:0; border-top:1px dashed var(--input-border); margin-bottom:20px;">
            
            <h4 style="margin:0 0 10px 0; color:var(--text-main); font-size:1rem;">Şifre Değiştir</h4>
            <div class="auth-form">
                <div class="form-group">
                    <input type="password" id="newPassword" placeholder="Yeni Şifre (En az 6 karakter)">
                </div>
                <div class="form-group">
                    <input type="password" id="newPasswordConfirm" placeholder="Yeni Şifre (Tekrar)">
                </div>
                <button class="auth-submit-btn" onclick="handleChangePassword()">Şifreyi Güncelle</button>
            </div>

            <button onclick="backToProfile()" style="background:none; border:none; color:var(--text-muted); width:100%; margin-top:15px; cursor:pointer; font-size:0.9rem;">
                &larr; Profile Geri Dön
            </button>
        </div>
    </div>

    <script src="{% static 'js/app.js' %}"></script>
</body>
</html>